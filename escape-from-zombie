<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Shooter in JavaScript</title>
    
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #222; /* Sfondo scuro per un look da gioco */
            flex-direction: column;
            font-family: 'Arial', sans-serif;
        }

        #gameContainer {
            position: relative;
        }

        #gameCanvas {
            border: 3px solid #ccc;
            background-color: #053d05; /* Colore campo erboso */
            display: block;
        }

        #uiDisplay {
            position: absolute;
            top: 0;
            left: 0;
            padding: 10px;
            color: white;
            font-size: 20px;
            z-index: 10;
        }
        
        #gameOverScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            color: #ff4444; /* Rosso vibrante per Game Over */
            padding: 40px 60px;
            text-align: center;
            border-radius: 15px;
            border: 5px solid #ff4444;
            display: none; /* Inizialmente nascosto */
        }
        
        #gameOverScreen h1 {
            margin-top: 0;
        }

        #gameOverScreen button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            background-color: #555;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="uiDisplay">Punteggio: 0</div>
        
        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <div id="gameOverScreen">
            <h1>GAME OVER</h1>
            <p>Sei stato sopraffatto! Punteggio finale: <span id="finalScore">0</span></p>
            <button onclick="startGame()">RICOMINCIA</button>
        </div>
    </div>

    <script>
        // --- 1. SETUP CANVAS ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const uiDisplay = document.getElementById('uiDisplay');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreDisplay = document.getElementById('finalScore');

        let gameLoopInterval;
        let gameOver = false;
        let score = 0;

        // --- 2. VARIABILI GLOBALI E CONTROLLI ---
        const keys = {}; // Mappa per tenere traccia dei tasti premuti (W, A, S, D)
        const bullets = [];
        const zombies = [];

        let zombieSpawnRate = 2000; // Tempo iniziale tra gli spawn (ms)
        let lastZombieSpawn = Date.now();

        // --- 3. CLASSE GIOCATORE (La Freccetta) ---
        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            size: 20,
            speed: 5,
            color: 'yellow', // Colore del giocatore (la freccetta)
            
            draw() {
                ctx.fillStyle = this.color;
                // Disegna il giocatore come un quadrato
                ctx.fillRect(this.x - this.size / 2, this.y - this.size / 2, this.size, this.size);
            },
            
            update() {
                // Movimento basato sui tasti premuti
                if (keys['w'] || keys['W'] || keys['ArrowUp']) this.y -= this.speed;
                if (keys['s'] || keys['S'] || keys['ArrowDown']) this.y += this.speed;
                if (keys['a'] || keys['A'] || keys['ArrowLeft']) this.x -= this.speed;
                if (keys['d'] || keys['D'] || keys['ArrowRight']) this.x += this.speed;

                // Limita il giocatore ai bordi del canvas
                this.x = Math.max(this.size / 2, Math.min(canvas.width - this.size / 2, this.x));
                this.y = Math.max(this.size / 2, Math.min(canvas.height - this.size / 2, this.y));
            }
        };

        // --- 4. CLASSE PROIETTILE ---
        class Bullet {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 4;
                this.speed = 10;
                this.color = 'red';
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
            }

            update() {
                // Spostamento del proiettile (semplificato verso l'alto)
                this.y -= this.speed;
            }
        }

        // --- 5. CLASSE ZOMBIE ---
        class Zombie {
            constructor() {
                this.size = 25;
                this.color = 'black';
                this.speed = Math.random() * 1.5 + 0.5; // Velocità tra 0.5 e 2
                this.spawnAtEdge();
            }
            
            spawnAtEdge() {
                const edge = Math.floor(Math.random() * 4); // 0:top, 1:bottom, 2:left, 3:right
                
                if (edge === 0) { // Top
                    this.x = Math.random() * canvas.width;
                    this.y = -this.size;
                } else if (edge === 1) { // Bottom
                    this.x = Math.random() * canvas.width;
                    this.y = canvas.height;
                } else if (edge === 2) { // Left
                    this.x = -this.size;
                    this.y = Math.random() * canvas.height;
                } else { // Right
                    this.x = canvas.width;
                    this.y = Math.random() * canvas.height;
                }
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.size, this.size);
            }

            update() {
                // Movimento verso il giocatore (Player)
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance > 0) {
                    // Normalizzazione del vettore di movimento
                    this.x += (dx / distance) * this.speed;
                    this.y += (dy / distance) * this.speed;
                }
            }
        }

        // --- 6. FUNZIONI DI GIOCO PRINCIPALI ---

        function startGame() {
            // Resetta lo stato del gioco
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
            bullets.length = 0;
            zombies.length = 0;
            score = 0;
            gameOver = false;
            zombieSpawnRate = 2000;
            uiDisplay.textContent = 'Punteggio: 0';
            gameOverScreen.style.display = 'none';

            // Aggiunge zombie iniziali
            for (let i = 0; i < 3; i++) {
                zombies.push(new Zombie());
            }
            
            // Avvia il loop principale a 60 FPS
            clearInterval(gameLoopInterval);
            gameLoopInterval = setInterval(gameLoop, 1000 / 60); 
        }

        function updateScore(points) {
            score += points;
            uiDisplay.textContent = 'Punteggio: ' + score;
        }

        function spawnZombie() {
            const now = Date.now();
            if (now - lastZombieSpawn > zombieSpawnRate) {
                zombies.push(new Zombie());
                lastZombieSpawn = now;
                // Aumenta la difficoltà riducendo il tempo di spawn
                if (zombieSpawnRate > 300) { 
                     zombieSpawnRate -= 5;
                }
            }
        }

        function checkCollisions() {
            // 1. Collisioni Proiettili vs Zombie
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                for (let j = zombies.length - 1; j >= 0; j--) {
                    const zombie = zombies[j];

                    // Collisione cerchio-rettangolo (semplificato)
                    const dist = Math.sqrt(
                        (bullet.x - (zombie.x + zombie.size / 2)) ** 2 + 
                        (bullet.y - (zombie.y + zombie.size / 2)) ** 2
                    );

                    if (dist < bullet.radius + zombie.size / 2) {
                        // Colpito!
                        bullets.splice(i, 1); // Rimuovi proiettile
                        zombies.splice(j, 1); // Rimuovi zombie
                        updateScore(10); 
                        zombies.push(new Zombie()); // Respawna un nuovo zombie
                        break; 
                    }
                }
            }

            // 2. Collisioni Giocatore vs Zombie
            for (let j = zombies.length - 1; j >= 0; j--) {
                const zombie = zombies[j];
                
                // Collisione rettangolare (Giocatore contro Zombie)
                if (
                    player.x - player.size / 2 < zombie.x + zombie.size &&
                    player.x + player.size / 2 > zombie.x &&
                    player.y - player.size / 2 < zombie.y + zombie.size &&
                    player.y + player.size / 2 > zombie.y
                ) {
                    // GAME OVER
                    gameOver = true;
                    clearInterval(gameLoopInterval);
                    finalScoreDisplay.textContent = score;
                    gameOverScreen.style.display = 'block';
                }
            }
        }

        function draw() {
            // Cancella lo schermo (sfondo)
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Disegna tutti gli elementi
            player.draw();
            zombies.forEach(zombie => zombie.draw());
            bullets.forEach(bullet => bullet.draw());
        }

        function gameLoop() {
            if (gameOver) return;

            // 1. Aggiornamento Logico
            player.update();
            bullets.forEach(bullet => bullet.update());
            zombies.forEach(zombie => zombie.update());
            
            spawnZombie();
            checkCollisions();

            // Rimuovi proiettili fuori schermo
            for (let i = bullets.length - 1; i >= 0; i--) {
                if (bullets[i].y < -bullets[i].radius) {
                    bullets.splice(i, 1);
                }
            }

            // 2. Rendering
            draw();
        }

        // --- 7. GESTIONE EVENTI (Input) ---
        
        // Tasto premuto
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // Tasto Spazio per sparare (spara solo quando il tasto viene premuto la prima volta)
            if (e.key === ' ' && !e.repeat) {
                // Spara un nuovo proiettile dal centro del giocatore (direzione verso l'alto)
                bullets.push(new Bullet(player.x, player.y));
            }
        });

        // Tasto rilasciato
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // Avvia il gioco al caricamento della pagina
        window.onload = startGame;

    </script>
</body>
</html>
